<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Silent Movie</title>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />

  <!-- Cinzel -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="style.css">
</head>

<body class="film-mode">

  <!-- 噪点 GIF -->
  <div class="noise"></div>

  <!-- 胶片竖线层 -->
  <div class="film"></div>

  <!-- 上下遮罩（3:4） -->
  <div class="mask top"></div>
  <div class="mask bottom"></div>

  <!-- 内容 -->
  <main id="content" class="locked">

    <!-- 片头 -->
    <h1 id="filmTitle" class="film-title develop">Silent Movie</h1>

    <!-- 正文 -->
    <div class="markdown">
      在这里，为了体现竖线动画的随机性，我们给:before和:after伪类分别设置了各自的动画步骤，在不同的时机点，竖线位置再水平方向上会进行平移。
      <br><br>
      接下来我们继续给噪点也添加上动画，同样也是通过keyframes帧动画来实现。
      <br><br>
      （这里可以继续加入更多正文，用于测试滚动）
      <br><br><br><br><br><br>
    </div>

    <!-- 片尾 -->
    <h2 id="filmEnd" class="film-end">end</h2>

  </main>

  <!-- 模式切换按钮 -->
  <button id="modeToggle">
    <i class="fa-solid fa-film"></i>
  </button>

  <!-- JS -->
  <script>
    const body = document.body;
    const toggleBtn = document.getElementById('modeToggle');
    const icon = toggleBtn.querySelector('i');
    const title = document.getElementById('filmTitle');
    const endTitle = document.getElementById('filmEnd');
    const content = document.getElementById('content');

    let mode = 'film';

    function applyMode() {
      if (mode === 'film') {
        body.classList.add('film-mode');
        body.classList.remove('book-mode');
        icon.className = 'fa-solid fa-film';

        title.classList.add('develop');
        endTitle.classList.remove('show');
        content.classList.add('locked');
      } else {
        body.classList.add('book-mode');
        body.classList.remove('film-mode');
        icon.className = 'fa-solid fa-book';

        title.classList.remove('develop');
        endTitle.classList.add('show');
        content.classList.remove('locked');
      }
    }

    toggleBtn.addEventListener('click', () => {
      mode = mode === 'film' ? 'book' : 'film';
      applyMode();
    });

    /* 片头显影完成 → 解锁正文 */
    title.addEventListener('animationend', () => {
      if (mode === 'film') {
        content.classList.remove('locked');
      }
    });

    /* 滚动到底 → 片尾显影 */
    content.addEventListener('scroll', () => {
      if (mode !== 'film') return;

      const nearBottom =
        content.scrollTop + content.clientHeight >= content.scrollHeight - 10;

      if (nearBottom) {
        endTitle.classList.add('show');
      }
    });

    applyMode();
  </script>
</body>
</html>
