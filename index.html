<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Silent Movie</title>

  <!-- Cinzel -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="stylesheet" href="style.css">
</head>

<body>
<div id="app">

  <div class="mask" id="mask-top"></div>

  <div id="stage">

    <!-- 内容层 -->
    <div id="content">
      <div class="film-title develop">Silent Movie</div>

      在这里，为了体现竖线动画的随机性，我们给 :before 和 :after 伪类分别设置了各自的动画步骤，在不同的时机点，竖线位置在水平方向上会进行平移。
      接下来我们继续给噪点也添加上动画，同样也是通过 keyframes 帧动画来实现。
      <br><br>
      在这里，为了体现竖线动画的随机性，我们给 :before 和 :after 伪类分别设置了各自的动画步骤，在不同的时机点，竖线位置在水平方向上会进行平移。
      接下来我们继续给噪点也添加上动画，同样也是通过 keyframes 帧动画来实现。
      <br><br>
      在这里，为了体现竖线动画的随机性，我们给 :before 和 :after 伪类分别设置了各自的动画步骤，在不同的时机点，竖线位置在水平方向上会进行平移。

      <div class="film-end">end</div>
    </div>

    <!-- 特效层 -->
    <div class="effects">
      <div class="film"></div>
      <div class="noise"></div>
    </div>

  </div>

  <div class="mask" id="mask-bottom"></div>
</div>

<div id="orientation-hint">请竖屏观看</div>

<button id="toggle">
  <i class="fa-regular fa-film"></i>
</button>

<script>
/* ========= 模式 ========= */
let mode = localStorage.getItem('mode') || 'film';

const title = document.querySelector('.film-title');
const content = document.getElementById('content');
const endText = document.querySelector('.film-end');
const toggleBtn = document.getElementById('toggle');
const toggleIcon = toggleBtn.querySelector('i');
const maskTop = document.getElementById('mask-top');
const maskBottom = document.getElementById('mask-bottom');
const stage = document.getElementById('stage');

let endRevealed = false;

/* ========= 字体 ========= */
function updateFontSize() {
  const w = window.innerWidth;
  const size = 16 + (w - 360) * (20 / 440);
  document.documentElement.style.setProperty(
    '--base-font',
    Math.round(size) + 'px'
  );
}

/* ========= 遮罩 ========= */
function updateMask() {
  if (mode !== 'film') return;

  const W = window.innerWidth;
  const H = window.innerHeight;
  const visibleH = W * 3 / 4;
  const maskH = Math.max(0, (H - visibleH) / 2);

  maskTop.style.height = maskH + 'px';
  maskBottom.style.height = maskH + 'px';
  stage.style.height = visibleH + 'px';
}

/* ========= 模式应用 ========= */
function applyMode() {
  document.body.className = mode === 'book' ? 'book' : '';

  if (mode === 'film') {
    toggleIcon.className = 'fa-regular fa-film';
    content.classList.add('locked');
    endText.classList.remove('reveal');
    endRevealed = false;
  } else {
    toggleIcon.className = 'fa-solid fa-book';
    content.classList.remove('locked');
    endText.classList.add('reveal');
  }

  updateMask();
}

/* ========= 标题显影结束 → 解锁滚动 ========= */
title.addEventListener('animationend', () => {
  if (mode === 'film') {
    content.classList.remove('locked');
  }
});

/* ========= 滚动到底 → 显影 end ========= */
content.addEventListener('scroll', () => {
  if (mode !== 'film' || endRevealed) return;

  const nearBottom =
    content.scrollTop + content.clientHeight >= content.scrollHeight - 20;

  if (nearBottom) {
    endText.classList.add('reveal');
    endRevealed = true;
  }
});

/* ========= 横竖屏 ========= */
function checkOrientation() {
  const hint = document.getElementById('orientation-hint');
  hint.classList.toggle('active', window.innerWidth > window.innerHeight);
}

/* ========= 切换 ========= */
toggleBtn.onclick = () => {
  mode = mode === 'film' ? 'book' : 'film';
  localStorage.setItem('mode', mode);
  applyMode();
};

window.addEventListener('resize', () => {
  updateFontSize();
  updateMask();
  checkOrientation();
});

/* ========= 初始化 ========= */
applyMode();
updateFontSize();
checkOrientation();
</script>
</body>
</html>
